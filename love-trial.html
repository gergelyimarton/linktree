<!doctype html>
<html lang="hu">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Love Trial</title>
  <link rel="stylesheet" href="./CSS/love-trial.css">

  
</head>
<body>
  <div class="body-container">
  <h1>Love Trial</h1>

  <h2>Fő aspektusok</h2>
  <table id="mainAspects">
    <thead>
      <tr><th>Fő aspektus</th><th>Casual hessz</th><th>Háztartási ismeretek</th><th>Kreatív önmegvalósítás</th><th>Fizikai próba</th><th>Mentális próba</th><th>Pontszám</th></tr>
    </thead>
    <tbody>
      <tr><td>🌿 Spontaneitás</td><td><select></select></td><td><select></select></td><td><select></select></td><td><select></select></td><td><select></select></td><td class="score">0</td></tr>
      <tr><td>🧠 Intelligencia / Kreativitás</td><td><select></select></td><td><select></select></td><td><select></select></td><td><select></select></td><td><select></select></td><td class="score">0</td></tr>
      <tr><td>🤝 Együttműködés</td><td><select></select></td><td><select></select></td><td><select></select></td><td><select></select></td><td><select></select></td><td class="score">0</td></tr>
      <tr><td>🧘‍♀️ Komfortzóna rugalmassága</td><td><select></select></td><td><select></select></td><td><select></select></td><td><select></select></td><td><select></select></td><td class="score">0</td></tr>
      <tr><td>🔥 Kitartás / Stresszkezelés</td><td><select></select></td><td><select></select></td><td><select></select></td><td><select></select></td><td><select></select></td><td class="score">0</td></tr>
      <tr><td>💡 Önreflexió</td><td><select></select></td><td><select></select></td><td><select></select></td><td><select></select></td><td><select></select></td><td class="score">0</td></tr>
      <tr><td>💬 Érzelmi intelligencia / Spiritualitás</td><td><select></select></td><td><select></select></td><td><select></select></td><td><select></select></td><td><select></select></td><td class="score">0</td></tr>
      <tr><td>😊 Hangulatom</td><td><select></select></td><td><select></select></td><td><select></select></td><td><select></select></td><td><select></select></td><td class="score">0</td></tr>
    </tbody>
  </table>

  <h2>Fontos aspektusok</h2>
  <table id="importantAspects">
    <thead>
      <tr><th>Aspektus</th><th>Összesített pont az 5. randi után</th></tr>
    </thead>
    <tbody>
      <tr><td>🎭 Humor</td><td><select></select></td></tr>
      <tr><td>🧲 Fizikai vonzalom</td><td><select></select></td></tr>
      <tr><td>🧩 Kapcsolódási könnyedség</td><td><select></select></td></tr>
      <tr><td>👕 Öltözködés</td><td><select></select></td></tr>
      <tr><td>🎧 Zenei ízlés</td><td><select></select></td></tr>
      <tr><td>🧼 Higiénia</td><td><select></select></td></tr>
      <tr><td>🫦 Szexualitás</td><td><select></select></td></tr>
      <tr><td>🌈 Sokszínűség (Egyéb tulajdonságok)</td><td id="diversityTotal">0</td></tr>
    </tbody>
  </table>

  <h2>Egyéb tulajdonságok</h2>
  <table id="otherProps">
    <thead><tr><th>Tulajdonság</th><th>Pont</th></tr></thead>
    <tbody>
      <tr><td>Ambíciózusság / Szenvedélyesség</td><td><select></select></td></tr>
      <tr><td>Autentikusság</td><td><select></select></td></tr>
      <tr><td>Bátorság</td><td><select></select></td></tr>
      <tr><td>Bölcsesség</td><td><select></select></td></tr>
      <tr><td>Család-központúság</td><td><select></select></td></tr>
      <tr><td>Energikusság</td><td><select></select></td></tr>
      <tr><td>Kalandvágyás / Kihíváskedvelés</td><td><select></select></td></tr>
      <tr><td>Kedvesség / Szelídség</td><td><select></select></td></tr>
      <tr><td>Nyugodtság</td><td><select></select></td></tr>
      <tr><td>Önállóság</td><td><select></select></td></tr>
      <tr><td>Őszinteség / Hűségesség</td><td><select></select></td></tr>
      <tr><td>Szerénység</td><td><select></select></td></tr>
      <tr><td>Udvariasság</td><td><select></select></td></tr>
      <tr><td><strong>Tulajdonságok összesített pontszáma</strong></td><td id="otherPropsTotal">0</td></tr>
    </tbody>
  </table>

  <h2>Összegzés</h2>
  <table id="summary">
    <tbody>
      <tr><td>Értékelt mezők száma</td><td id="filledCount">0 db</td></tr>
      <tr><td>Elérhető max pontszám</td><td id="maxScore">0 pont</td></tr>
      <tr><td>Elért pontszám</td><td id="achievedScore">0 pont</td></tr>
      <tr><td>Illeszkedési arány</td><td id="fitRatio">0,00%</td></tr>
    </tbody>
  </table>

  <h2>Értelmezés</h2>
  <table>
    <tbody>
      <tr><td>90–100%</td><td>🟩 Kivételes illeszkedés</td></tr>
      <tr><td>70–89%</td><td>🟦 Erős kompatibilitás</td></tr>
      <tr><td>40–69%</td><td>🟨 Részleges kompatibilitás</td></tr>
      <tr><td>20–39%</td><td>🟧 Figyelmeztető zóna</td></tr>
      <tr><td>0–19%</td><td>🟥 Alacsony illeszkedés</td></tr>
    </tbody>
  </table>

  <button class="btn" onclick="downloadJSON()">Eredmény letöltése (JSON)</button>
  <input type="file" id="jsonUpload" accept="application/json" class="btn" />

  <a href="projects.html">
    <button class="back-button">Go back</button>
  </a>

  <footer>
    Ez egy statikus HTML oldal. Az adatok lenyíló listákból választhatók. A letöltött JSON tartalmazza az aktuális állapotot, amit később vissza lehet tölteni.
  </footer>
  
  
  









  <script>
    window.addEventListener('DOMContentLoaded', () => {
      // 1. Feltöltjük az összes selectet 1–5 opciókkal (+ üres)
      document.querySelectorAll('select').forEach(sel => {
        sel.innerHTML = '<option value="">-</option>' +
          Array.from({length:5}, (_,i)=>`<option value="${i+1}">${i+1}</option>`).join('');
    
        sel.addEventListener('change', updateAll);
      });
    
      // 2. MainAspects utolsó oszlop létrehozása (ha még nincs span)
      document.querySelectorAll('#mainAspects tbody tr').forEach(tr=>{
        const lastTd = tr.querySelector('td.score');
        if(!lastTd) {
          const tds = tr.querySelectorAll('td');
          tds[tds.length-1].innerHTML = '<span class="score">0</span>';
        }
      });
    
      updateAll(); // induláskor is frissít
    });
    











    function updateAll() {
  // 🔹 1. Frissítjük mainAspects pontszám oszlopait
  document.querySelectorAll('#mainAspects tbody tr').forEach(tr=>{
    const selects = Array.from(tr.querySelectorAll('select')).slice(0,5);
    const scoreSpan = tr.querySelector('.score') || tr.querySelector('td:last-child');
    const sum = selects.reduce((acc, s) => acc + Number(s.value || 0), 0);
    if(scoreSpan) scoreSpan.textContent = sum;
  });

  // 🔹 2. Összesített értékek csak mainAspects + importantAspects
  let totalSum = 0;
  let filled = 0;

  document.querySelectorAll('#mainAspects select, #importantAspects select').forEach(sel => {
    const v = parseInt(sel.value,10);
    if(!isNaN(v)){
      totalSum += v;
      filled++;
    }
  });

  // 🔹 3. Összesített pont az "Egyéb tulajdonságok" táblázatból
  let otherSum = 0;
  document.querySelectorAll('#otherProps tbody tr:not(:last-child) select').forEach(sel=>{
    const v = parseInt(sel.value,10);
    if(!isNaN(v)) otherSum += v;
  });
  document.getElementById('otherPropsTotal').textContent = otherSum;

  // 🔹 4. DiversityScore az otherPropsTotal alapján
  const totalForDiversity = parseInt(document.getElementById('otherPropsTotal').textContent,10) || 0;
  let diversityScore = 0;
  if(totalForDiversity <= 10) diversityScore = 0;
  else if(totalForDiversity <= 20) diversityScore = 1;
  else if(totalForDiversity <= 30) diversityScore = 2;
  else if(totalForDiversity <= 40) diversityScore = 3;
  else if(totalForDiversity <= 50) diversityScore = 4;
  else if(totalForDiversity > 60) diversityScore = 5;

  document.getElementById('diversityTotal').textContent = diversityScore;

  // 🔹 5. Hozzáadjuk a diversityScore-t a totalSum-hoz
  totalSum += diversityScore;

  const maxScore = filled*5 + 5; // a diversityScore max 5 pont, hozzáadjuk a maxhoz is
  const fitRatio = filled>0 ? ((totalSum/maxScore)*100).toFixed(2) : '0.00';

  document.getElementById('filledCount').textContent = filled + 1 + ' db';
  document.getElementById('maxScore').textContent = maxScore + ' pont';
  document.getElementById('achievedScore').textContent = totalSum + ' pont';
  document.getElementById('fitRatio').textContent = fitRatio + '%';
}

// minden select változáskor frissítünk
document.querySelectorAll('select').forEach(sel=>{
  sel.addEventListener('change', updateAll);
});

// induláskor is frissítjük
updateAll();










    document.querySelectorAll('#otherProps select').forEach(sel => {
      sel.innerHTML = '<option value="">-</option>' + 
                    Array.from({length:5}, (_,i)=>`<option value="${i+1}">${i+1}</option>`).join('');
      sel.addEventListener('change', updateOtherPropsTotal);
    });

    function updateOtherPropsTotal() {
      let sum = 0;
      document.querySelectorAll('#otherProps tbody tr:not(:last-child) select').forEach(sel => {
      const v = parseInt(sel.value,10);
      if(!isNaN(v)) sum += v;
      });
      document.getElementById('otherPropsTotal').textContent = sum;
    }

    // induláskor is frissítjük
    updateOtherPropsTotal();
















    // 🔹 JSON letöltés és feltöltés
    function tableToArray(tableId){
      const rows = document.querySelectorAll(`#${tableId} tbody tr`);
      return Array.from(rows).map(r=> Array.from(r.querySelectorAll('td')).map(td=>{
        const sel = td.querySelector('select');
        return sel ? sel.value : td.innerText.trim();
      }));
    }
    
    function downloadJSON(){
      const data = {
        mainAspects: tableToArray('mainAspects'),
        importantAspects: tableToArray('importantAspects'),
        otherProps: tableToArray('otherProps')
      };
      const blob = new Blob([JSON.stringify(data,null,2)], {type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href=url; a.download='love-trial.json'; a.click();
      URL.revokeObjectURL(url);
    }
    
    document.getElementById('jsonUpload').addEventListener('change', function(){
      const file = this.files[0];
      if(!file) return;
      const reader = new FileReader();
      reader.onload = e => {
        try{
          const data = JSON.parse(e.target.result);
          function fillTable(tableId, arr){
            const rows = document.querySelectorAll(`#${tableId} tbody tr`);
            arr.forEach((row,i)=>{
              if(rows[i]){
                const cells = rows[i].querySelectorAll('td');
                row.forEach((val,j)=>{
                  if(cells[j]){
                    const sel = cells[j].querySelector('select');
                    if(sel){ sel.value = val; } else { cells[j].innerText = val; }
                  }
                });
              }
            });
          }
          fillTable('mainAspects', data.mainAspects||[]);
          fillTable('importantAspects', data.importantAspects||[]);
          fillTable('otherProps', data.otherProps||[]);
          updateAll(); // frissítjük a számításokat a betöltött adatokkal
        }catch(err){
          alert('Hibás JSON fájl.');
        }
      };
      reader.readAsText(file);
    });
  </script>
    
</div>
</body>

</html>
