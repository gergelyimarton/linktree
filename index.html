<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Marton Gergelyi</title>
  <meta name="description" content="Music producer, rapper, developer. Nitebork | Duplajézus">
  <link rel="icon" href="images/favicon.ico" type="image/x-icon">

  <!--
    ROOT DISPATCHER
    ================
    This page detects WebGL capability and routes to the appropriate version:
    - /lidar/  → New LiDAR design (requires WebGL)
    - /legacy/ → Original design (fallback)

    To force a specific version:
    - Add ?version=lidar to URL for LiDAR
    - Add ?version=legacy to URL for Legacy
  -->

  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      background: #030305;
      color: #c8c8d0;
      font-family: 'JetBrains Mono', 'Fira Code', monospace;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .dispatcher {
      text-align: center;
      padding: 32px;
    }

    .dispatcher__status {
      font-size: 11px;
      letter-spacing: 0.15em;
      text-transform: uppercase;
      color: #00ff88;
      margin-bottom: 16px;
    }

    .dispatcher__spinner {
      width: 24px;
      height: 24px;
      border: 2px solid rgba(0, 255, 136, 0.2);
      border-top-color: #00ff88;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
      margin: 0 auto 16px;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .dispatcher__fallback {
      display: none;
      margin-top: 24px;
    }

    .dispatcher__fallback a {
      display: inline-block;
      margin: 8px;
      padding: 12px 24px;
      color: #c8c8d0;
      text-decoration: none;
      border: 1px solid rgba(0, 255, 136, 0.2);
      font-size: 11px;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      transition: border-color 0.2s, color 0.2s;
    }

    .dispatcher__fallback a:hover {
      border-color: #00ff88;
      color: #00ff88;
    }

    /* Show fallback if JS is disabled */
    noscript .dispatcher__fallback {
      display: block;
    }
  </style>
</head>
<body>

  <div class="dispatcher">
    <div class="dispatcher__spinner"></div>
    <div class="dispatcher__status">Initializing...</div>

    <noscript>
      <div class="dispatcher__fallback">
        <p style="margin-bottom: 16px; color: #505060;">JavaScript disabled. Choose version:</p>
        <a href="legacy/index.html">Classic</a>
        <a href="lidar/index.html">LiDAR</a>
      </div>
    </noscript>
  </div>

  <script>
    (function() {
      'use strict';

      // ============================================================
      // CONFIGURATION
      // ============================================================

      const CONFIG = {
        // Default to LiDAR if capable
        defaultVersion: 'lidar',

        // Minimum requirements for LiDAR
        minCores: 2,
        minMemory: 2, // GB

        // URL paths
        paths: {
          lidar: 'lidar/index.html',
          legacy: 'legacy/index.html'
        }
      };

      // ============================================================
      // CAPABILITY DETECTION
      // ============================================================

      function hasWebGL() {
        try {
          const canvas = document.createElement('canvas');
          const gl = canvas.getContext('webgl2') || canvas.getContext('webgl');
          return !!gl;
        } catch (e) {
          return false;
        }
      }

      function hasAdequateHardware() {
        const cores = navigator.hardwareConcurrency || 1;
        const memory = navigator.deviceMemory || 4; // Default to 4 if not available

        return cores >= CONFIG.minCores && memory >= CONFIG.minMemory;
      }

      function prefersReducedMotion() {
        return window.matchMedia('(prefers-reduced-motion: reduce)').matches;
      }

      function isMobile() {
        return /Android|iPhone|iPad|iPod|webOS|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
      }

      function canUseLidar() {
        // Mobile devices get legacy for performance
        if (isMobile()) return false;

        // Must have WebGL
        if (!hasWebGL()) return false;

        // Must have adequate hardware
        if (!hasAdequateHardware()) return false;

        // Respect reduced motion preference
        if (prefersReducedMotion()) return false;

        return true;
      }

      // ============================================================
      // URL PARAMETER HANDLING
      // ============================================================

      function getUrlVersion() {
        const params = new URLSearchParams(window.location.search);
        const version = params.get('version');

        if (version === 'lidar' || version === 'legacy') {
          return version;
        }

        return null;
      }

      function getStoredPreference() {
        try {
          return localStorage.getItem('linktree-design-version');
        } catch {
          return null;
        }
      }

      // ============================================================
      // REDIRECT LOGIC
      // ============================================================

      function redirect() {
        const status = document.querySelector('.dispatcher__status');

        // Check URL parameter first (allows override)
        const urlVersion = getUrlVersion();
        if (urlVersion) {
          status.textContent = `Version: ${urlVersion} (forced)`;
          setTimeout(() => {
            window.location.replace(CONFIG.paths[urlVersion]);
          }, 200);
          return;
        }

        // Check stored preference
        const storedVersion = getStoredPreference();
        if (storedVersion && CONFIG.paths[storedVersion]) {
          status.textContent = `Version: ${storedVersion} (saved)`;
          setTimeout(() => {
            window.location.replace(CONFIG.paths[storedVersion]);
          }, 200);
          return;
        }

        // Auto-detect based on capability
        const version = canUseLidar() ? 'lidar' : 'legacy';
        status.textContent = `Detected: ${version}`;

        setTimeout(() => {
          window.location.replace(CONFIG.paths[version]);
        }, 300);
      }

      // ============================================================
      // INITIALIZATION
      // ============================================================

      // Small delay for visual feedback
      setTimeout(redirect, 100);

    })();
  </script>

</body>
</html>
